(window._vfP=window._vfP||[]).push([[184],{627:function(t,e,n){"use strict";n.r(e),n.d(e,"storeModule",(function(){return lt}));n(17),n(26),n(3),n(15),n(16),n(57),n(143),n(44),n(40),n(9),n(11),n(32),n(19),n(33),n(28);var r=n(4),c=n(144),o=n(857),i=n(1),u=n(18);function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,c,o=[],i=!0,u=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){u=!0,c=t}finally{try{i||null==n.return||n.return()}finally{if(u)throw c}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var d=["actor_uuid","content","content_container_uuid","content_uuid","parent_actor_uuid","parent_uuid","section_uuid","thread_uuid"];function l(t,e,n){var r=Object.entries(n).filter((function(t){var e=a(t,1)[0];return d.includes(e)})).reduce((function(t,e){var n=a(e,2),r=n[0],c=n[1];return t[r]=c,t}),{});u.a.getInstance().$publish(t,e,r)}var b={[r.m]:Object(o.a)(i.e.CHANNEL,i.e.EVENTS.CREATED,c.b,l),[r.n]:Object(o.a)(i.l.CHANNEL,i.l.EVENTS.POSTED,c.y,l,!0)},_=n(923),f={[r.bb]:Object(_.a)(c.q),[r.ab]:Object(_.a)(c.o),[r.ub]:Object(_.b)(c.r)},p=(n(7),n(0)),m=n(2),y=n(21),h=n(241),v=(n(308),n(924)),O={[r.Lb](t,e){switch(e.message_type){case h.b.LIVECOMMENT:return e.action!==h.a.UPDATED||(t.commit(m.oc,{key:e.content_uuid,item:e.payload.settings}),t.commit(m.jc,{key:e.content_uuid,item:{title:e.payload.title}})),Promise.resolve();case h.b.LIVECOMMENT_POST:case h.b.REPLY_TO_LIVECOMMENT_POST_DEPRECATED:var n=t.getters[p.R](e.content_uuid);return n&&(!n.date_edited&&e.payload.date_edited||n.date_edited<e.payload.date_edited)||e.payload.actor_uuid===t.getters[p.jb]?Promise.resolve():e.payload.thread_uuid===e.payload.content_container_uuid?t.dispatch(r.Qb,e):t.dispatch(r.Rb,e);default:return Promise.resolve()}},[r.Qb](t,e){switch(e.action){case h.a.PICKED:return Object(v.b)(t,e);case h.a.UNPICKED:return Object(v.f)(t,e);case h.a.PINNED:return Object(v.c)(t,e);case h.a.UNPINNED:return Object(v.g)(t,e)}if(t.getters[p.Tb])switch(e.action){case h.a.CREATED:return Object(v.h)(t,e);default:return Promise.resolve()}switch(e.action){case h.a.VISIBLE:return Object(v.h)(t,e);case h.a.DISABLED:case h.a.DELETED:return Object(v.a)(t,e);default:return Promise.resolve()}},[r.Rb](t,e){if(t.getters[p.Tb])switch(e.action){case h.a.CREATED:return Object(v.e)(t,e);default:return Promise.resolve()}switch(e.action){case h.a.VISIBLE:return Object(v.e)(t,e);case h.a.DISABLED:case h.a.DELETED:return Object(v.d)(t,e);default:return Promise.resolve()}},[y.i]:(t,e)=>t.state[e.container_uuid]?t.dispatch(r.Lb,e):Promise.resolve()},j=n(925),g={[r.Vb]:j.c(c.v),[r.od]:j.e(c.B),[r.G]:j.a(c.g),[r.jd]:j.d(c.A),[r.Fb]:j.b(c.j)},w=(n(38),n(126)),P=n(6),E=n(240),k=n(51),D=n(81),T=n(22),C=function(t){return{content_container_uuid:t,title:"",cursor:void 0,is_subscribed:!1,is_stale:!1,all_content_count:0,featured_content_count:0,current_tab:null}},S=(n(91),n(214),n(215),n(216),n(145),n(102),n(39)),I=n(71),A=n(24);function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function L(t,e,n,r){var c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(A.b)(t,"sectionUuid","getContentContainerSubscription"),Object(A.b)(e,"contentContainerUuid","getContentContainerSubscription");var c,o="/v5/subscriptions/{section_uuid}/contentcontainers/{content_container_uuid}".replace("{".concat("section_uuid","}"),encodeURIComponent(String(t))).replace("{".concat("content_container_uuid","}"),encodeURIComponent(String(e))),i=S.parse(o,!0);r&&(c=r.baseOptions);var u=N(N({method:"GET"},c),n),a={},s={};if(r&&r.accessToken){var d="function"==typeof r.accessToken?r.accessToken():r.accessToken;a.Authorization="Bearer "+d}return r&&(r.username||r.password)?a.Authorization="Basic "+btoa(r.username+":"+r.password):u.withCredentials=!0,i.query=N(N(N({},i.query),s),n.query),delete i.search,u.headers=N(N({},a),n.headers),{url:S.format(i),options:u}}(t,e,n,r),o=N(N({},c.options),{},{url:A.a+c.url});return I.a.request(o)}function R(t,e,n,r,c){var o=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(A.b)(t,"sectionUuid","subscribeToContentContainer"),Object(A.b)(e,"contentContainerUuid","subscribeToContentContainer");var o,i="/v5/subscriptions/{section_uuid}/contentcontainers/{content_container_uuid}".replace("{".concat("section_uuid","}"),encodeURIComponent(String(t))).replace("{".concat("content_container_uuid","}"),encodeURIComponent(String(e))),u=S.parse(i,!0);c&&(o=c.baseOptions);var a=N(N({method:"POST"},o),r),s={},d={};if(c&&c.accessToken){var l="function"==typeof c.accessToken?c.accessToken():c.accessToken;s.Authorization="Bearer "+l}c&&(c.username||c.password)?s.Authorization="Basic "+btoa(c.username+":"+c.password):a.withCredentials=!0,s["Content-Type"]="application/json",u.query=N(N(N({},u.query),d),r.query),delete u.search,a.headers=N(N({},s),r.headers);var b="string"!=typeof n||"application/json"===a.headers["Content-Type"];return a.data=b?JSON.stringify(void 0!==n?n:{}):n||"",{url:S.format(u),options:a}}(t,e,n,r,c),i=N(N({},o.options),{},{url:A.a+o.url});return I.a.request(i)}function q(t,e,n,r){var c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(A.b)(t,"sectionUuid","unsubscribeFromContentContainer"),Object(A.b)(e,"contentContainerUuid","unsubscribeFromContentContainer");var c,o="/v5/subscriptions/{section_uuid}/contentcontainers/{content_container_uuid}".replace("{".concat("section_uuid","}"),encodeURIComponent(String(t))).replace("{".concat("content_container_uuid","}"),encodeURIComponent(String(e))),i=S.parse(o,!0);r&&(c=r.baseOptions);var u=N(N({method:"DELETE"},c),n),a={},s={};if(r&&r.accessToken){var d="function"==typeof r.accessToken?r.accessToken():r.accessToken;a.Authorization="Bearer "+d}return r&&(r.username||r.password)?a.Authorization="Basic "+btoa(r.username+":"+r.password):u.withCredentials=!0,i.query=N(N(N({},i.query),s),n.query),delete i.search,u.headers=N(N({},a),n.headers),{url:S.format(i),options:u}}(t,e,n,r),o=N(N({},c.options),{},{url:A.a+c.url});return I.a.request(o)}var z=n(103);n(125);function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=w.b,G=P.d.COMMENTS,K={[r.p](t,e){var n=t.dispatch,o=e.section_uuid,i=e.container_id,u=e.title,a=e.settings,s=e.widget_settings,d=s.limit,l=s.reply_limit,b=s.sorted_by,_=s.signature;a=V(V({},{activation_time:Date.now(),expiry_time:null,is_hidden:!1,maximum_content_length:1800,is_content_premoderation_enabled:!0}),a);var f={container_id:i,title:u,settings:a},p={signature:s.signature};return Object(c.c)({section_uuid:o,container:f},p).then((function(){return Object(c.m)({section_uuid:o,container_id:i,limit:d,reply_limit:l,sorted_by:b},{signature:_}).then((function(t){var e={section_uuid:o,container_id:i,widget_settings:s,response:t};return n(r.pc,e)}))}))},[r.wd](t,e){var n=t.getters,r=t.commit,o=e.content_container_uuid,i=e.settings,u=n[p.Bc](o),a=n[p.U](o),s=V({expiry_time:a.expiry_time,is_content_premoderation_enabled:a.is_content_premoderation_enabled,is_hidden:a.is_hidden},i),d={section_uuid:u,content_container_uuid:o,settings:s},l={key:o,item:s};return Object(c.F)(d).then(z.b).then((function(){r(m.oc,l)}))},[r.z](t,e){var n=t.getters,r=t.commit,o=e.content_container_uuid,i=e.settings,u={section_uuid:n[p.Bc](o),content_container_uuid:o,settings:Object.keys(i)},a={key:o,item:i};return Object(c.e)(u).then(z.b).then((function(){r(m.oc,a)}))},[r.pc](t,e){var n=t.commit,c=t.dispatch,o=e.response,i=o.content_container_uuid,u=o.container,a=e.widget_settings;n("".concat(E.a,"/").concat(m.ac),i),n(m.nb,{key:i,item:{content_container_uuid:i}}),n(m.bd,{key:i,item:a}),n(m.jc,{key:i,item:{all_content_count:u.total_visible_content}});var s=c(r.oc,e),d=c(r.db,i);return Promise.all([s,d])},[r.oc](t,e){var n=t.commit,c=t.getters,o=t.dispatch,i=e.container_id,a=e.response,s=e.section_uuid,d=a.content_container_uuid,l=a.more_available,b=a.container,_=a.contents,f=b.settings,y=b.title,h=b.total_visible_content,v=c[p.Wb],O=c[p.Fc].locationId;n(m.nb,{key:d,item:{is_stale:v}}),n(m.oc,{key:d,item:f}),n(m.nc,{key:d,item:{locationId:O,total_visible_content:h}}),n(m.jc,{key:d,item:{cursor:H(d,_),title:y}}),n(m.c,{container_id:i,content_container_type:F,content_container_uuid:d}),u.a.getInstance().$publish("analytics","content_container_load",{content_container_uuid:d,content_container_type:F,widget_type:G,allCommentsCount:c[p.h](d)});var j=o(r.Gc,{content_container_uuid:d,contents:_,shouldSetUsersSynchronously:!0}).then((function(){return o("".concat(E.a,"/").concat(r.u),{content_container_uuid:d,contents:_,more_available:l})})),g=new Promise((function(t,e){window.vf.context.get("user").then((function(n){return Object(T.s)(n)?o(r.lb,{section_uuid:s,content_container_uuid:d}).then((function(){return t.apply(void 0,arguments)})).catch((function(){return e.apply(void 0,arguments)})):t()}))}));return new Promise((function(t,e){j.then((function(e){var n=[e];g.then((function(e){n.push(e),t(n)})).catch((function(){t(n)}))})).catch((function(t){e(t)}))}))},[r.kb](t,e){var n,o=t.commit,i=t.dispatch,u=t.getters,a=u[p.zd](e),s=a.pagination_limit,d=a.reply_limit,l=a.sorted_by,b=u[p.Bc](e),_=u["".concat(E.a,"/").concat(p.Uc)](e).page_from;return Object(c.k)({starting_from:_,section_uuid:b,content_container_uuid:e,limit:s,reply_limit:d,sorted_by:l}).then((function(t){var c=t.more_available,u=t.contents;return n=u,o(m.jc,{key:e,item:{cursor:H(e,u)}}),o("".concat(E.a,"/").concat(m.Tc),{thread_uuid:e,more_available:c}),i(r.Gc,{content_container_uuid:e,contents:n,shouldSetUsersSynchronously:!0})})).then((function(){return i("".concat(E.a,"/").concat(r.u),{content_container_uuid:e,contents:n})})).then((function(){var t=n.filter((function(t){return t.thread_uuid===e}));return o("".concat(E.a,"/").concat(m.B),{thread_uuid:e,contents:t,new_page:!0}),t}))},[r.db](t,e){var n,o,i=t.commit,u=t.dispatch,a=t.getters,s=a[p.zd](e),d=s.limit,l=s.sorted_by,b=a[p.Bc](e),_=a["".concat(E.b,"/").concat(p.Uc)](e)?a["".concat(E.b,"/").concat(p.Uc)](e).page_from:null;return Object(c.k)({starting_from:_,section_uuid:b,content_container_uuid:e,limit:d,sorted_by:l,reply_limit:2,filtered_by:k.d.FEATURED}).then((function(t){var c=t.contents,i=t.more_available;return n=c,o=i,u(r.Gc,{content_container_uuid:e,contents:n,shouldSetUsersSynchronously:!0})})).then((function(){return n=n.filter((function(t){var e=t.actor_uuid,n=t.state;return!a[p.md](e)&&n===D.c.VISIBLE})),u("".concat(E.b,"/").concat(r.u),{content_container_uuid:e,contents:n})})).then((function(){var t=n.filter((function(t){return t.thread_uuid===e}));return i("".concat(E.b,"/").concat(m.B),{thread_uuid:e,contents:t,new_page:!0}),i("".concat(E.b,"/").concat(m.Tc),{thread_uuid:e,more_available:o}),i(m.kd,{content_container_uuid:e,count:t.length}),t}))},[r.lb](t,e){var n=t.commit,r=e.section_uuid,c=e.content_container_uuid;return L(r,c).then(z.b).catch((function(t){return 401!==t.error_status&&404!==t.error_status&&Promise.reject(t)})).then((function(t){n(m.jc,{key:c,item:{is_subscribed:Boolean(t)}})})).catch((function(t){}))},[r.Kc](t,e){var n=t.commit,r=e.section_uuid,c=e.content_container_uuid,o=e.author_host_section_uuid;return n(m.jc,{key:c,item:{is_subscribed:!0}}),R(r,c,{author_host_section_uuid:o}).then(z.b).catch((function(){n(m.jc,{key:c,item:{is_subscribed:!1}})}))},[r.ud](t,e){var n=t.commit,r=e.section_uuid,c=e.content_container_uuid;return n(m.jc,{key:c,item:{is_subscribed:!1}}),q(r,c).then(z.b).catch((function(){n(m.jc,{key:c,item:{is_subscribed:!0}})}))},[r.zd](t,e){var n=t.commit,c=t.dispatch,o=t.getters,i=e.sorted_by,u=e.content_container_uuid;return o[p.zd](u).sorted_by===i?Promise.resolve():(n(m.jc,{key:u,item:{cursor:void 0,contents:[]}}),n(m.bd,{key:u,item:{sorted_by:i}}),n("".concat(E.a,"/").concat(m.N),u),c(r.kb,u))},[r.yc](t,e){var n=t.commit,c=t.dispatch;return n(m.jc,{key:e,item:{cursor:void 0,contents:[],is_stale:!1}}),n("".concat(E.a,"/").concat(m.N),e),c(r.kb,e)}},H=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0!==e.length){var n=e[e.length-1],r=n.thread_uuid,c=n.content_uuid;return r===t?c:r}},$=n(926),J={[r.j]:$.a(c.a),[r.I]:$.c(c.w),[r.K]:$.d(c.C),[r.Jc]:$.g(c.z),[r.td]:$.i(c.E),[r.R]:$.e(c.i),[r.D]:$.b(c.f),[r.mc]:$.f(c.x),[r.rd]:$.h(c.D)},Q=n(927),W=n(769);function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){Z(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var tt,et={[r.N]:Q.a(c.h),[r.Dc](t,e){var n=t.commit,r=t.getters;if(!r[p.X](e))return Promise.reject();var o=Y(Y({},Object(W.a)(r,{content_uuid:e})),{},{content_uuid:e});return c.d(o).then(z.b).then((function(){var t=r[p.R](e),c=r[p.kd](t.actor_uuid),o=t.total_replies&&!Object(T.I)(c)?D.c.HIDDEN:D.c.DISABLED;n(m.pc,{content_uuid:e,simplified_state:o})}))}},nt=!1,rt={[r.fc](t,e){var n=t.state,r=t.commit;if(e&&(clearTimeout(tt),nt)){nt=!1;var c={is_stale:!0};Object.keys(n).forEach((function(t){r(m.nb,{key:t,item:c})}))}e||(tt=setTimeout((function(){nt=!0}),5e3))}};function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ot(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach((function(e){it(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function it(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ut=ot(ot(ot(ot(ot(ot(ot(ot({},b),f),K),O),g),J),et),rt),at=n(37),st=n(47),dt={[p.ic]:function(t){return function(e){return t[e]}},[p.Zb]:function(t){return function(e){return t[e].is_subscribed}},[p.h]:function(t){return function(e){return t[e].all_content_count}},[p.nb]:function(t){return function(e){return t[e].featured_content_count}},[p.jc]:function(t){return function(e){return t[e].current_tab}}},lt=function(){return{actions:ut,mutations:{[m.nb]:Object(st.h)(at.default,C),[m.jc]:Object(st.g)(),[m.kd]:function(t,e){var n=e.content_container_uuid,r=e.count;t[n].featured_content_count+=r},[m.jd]:function(t,e){var n=e.content_container_uuid,r=e.count;t[n].all_content_count+=r}},getters:dt}}}}]);
//# sourceMappingURL=livecomments-module-js.2aef6897d5add0fa9e7a.js.map